name: Run go-tuf-mirror
on:
  pull_request:
  workflow_dispatch:
env:
  DOCKER_CONFIG: ${{ github.workspace }}/.docker
jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: dockerpublicbot
          password: ${{ secrets.DOCKERPUBLICBOT_WRITE_PAT }}
      - name: Mirror metadata
        uses: docker/go-tuf-mirror/actions/metadata@feat-add-prod-root
        with:
          source: https://docker.github.io/tuf-staging/metadata
          destination: docker://docker/tuf-metadata-staging:latest
          tuf-root: staging
          flags: "-f"
      - name: Mirror targets
        uses: docker/go-tuf-mirror/actions/targets@feat-add-prod-root
        with:
          metadata: https://docker.github.io/tuf-staging/metadata
          source: https://docker.github.io/tuf-staging/targets
          destination: docker://docker/tuf-targets-staging
          tuf-root: staging
          flags: "-f"
